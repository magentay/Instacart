{"paragraphs":[{"text":"%spark.pyspark\r\n\r\nfrom pyspark.sql import SparkSession\r\nfrom pyspark.sql import functions as F\r\n\r\nspark = SparkSession\\\r\n        .builder\\\r\n        .appName(\"PipelineExample\")\\\r\n        .getOrCreate()\r\n","user":"anonymous","dateUpdated":"2017-07-25T09:11:54-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500676255281_-19414802","id":"20170721-153055_1550559261","dateCreated":"2017-07-21T15:30:55-0700","dateStarted":"2017-07-25T09:11:55-0700","dateFinished":"2017-07-25T09:12:16-0700","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2999"},{"text":"%spark.pyspark\nfilepath1 = '/data/Instacart/orders.csv'\norders = spark.read.csv(filepath1, header= True, inferSchema=True)\norders.show(5)\n\norders.createOrReplaceTempView(\"orders\")","user":"anonymous","dateUpdated":"2017-07-25T09:33:00-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+-------+--------+------------+---------+-----------------+----------------------+\n|order_id|user_id|eval_set|order_number|order_dow|order_hour_of_day|days_since_prior_order|\n+--------+-------+--------+------------+---------+-----------------+----------------------+\n| 2539329|      1|   prior|           1|        2|                8|                  null|\n| 2398795|      1|   prior|           2|        3|                7|                  15.0|\n|  473747|      1|   prior|           3|        3|               12|                  21.0|\n| 2254736|      1|   prior|           4|        4|                7|                  29.0|\n|  431534|      1|   prior|           5|        4|               15|                  28.0|\n+--------+-------+--------+------------+---------+-----------------+----------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500745404104_-729592415","id":"20170722-104324_1030360567","dateCreated":"2017-07-22T10:43:24-0700","dateStarted":"2017-07-25T09:33:01-0700","dateFinished":"2017-07-25T09:33:03-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3000"},{"text":"%spark.pyspark\nfilepath2 = '/data/Instacart/order_products__prior.csv'\npriors = spark.read.csv(filepath2, header = True, inferSchema=True)\npriors.show(5)\n\npriors.createOrReplaceTempView(\"priors\")","user":"anonymous","dateUpdated":"2017-07-24T22:42:23-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1500754228604_-125558617","id":"20170722-131028_149895877","dateCreated":"2017-07-22T13:10:28-0700","dateStarted":"2017-07-24T22:42:31-0700","dateFinished":"2017-07-24T22:42:39-0700","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3001"},{"text":"%spark.pyspark\nfilepath3 = '/data/Instacart/order_products__train.csv'\ntrain = spark.read.csv(filepath3, header = True, inferSchema=True)\ntrain.show(5)\n\ntrain.createOrReplaceTempView(\"train\")","user":"anonymous","dateUpdated":"2017-07-25T09:12:57-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------------+---------+\n|order_id|product_id|add_to_cart_order|reordered|\n+--------+----------+-----------------+---------+\n|       1|     49302|                1|        1|\n|       1|     11109|                2|        1|\n|       1|     10246|                3|        0|\n|       1|     49683|                4|        0|\n|       1|     43633|                5|        1|\n+--------+----------+-----------------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500754498339_-1414287355","id":"20170722-131458_1022750834","dateCreated":"2017-07-22T13:14:58-0700","dateStarted":"2017-07-25T09:12:57-0700","dateFinished":"2017-07-25T09:13:03-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3002"},{"text":"%spark.pyspark\n\norders = spark.sql(\"SELECT *, sum(days_since_prior_order) over (PARTITION BY user_id ORDER BY days_since_prior_order) as days From orders \")\norders = orders.na.fill({'days':0})\nmaxorder = orders.groupBy('user_id').agg(F.count(\"order_number\").alias('max_order'), F.max( \"days\").alias(\"max_days\"))\norders = orders.join(maxorder, on = ['user_id'], how= 'left')\n\ndel maxorder\n\norders = orders.withColumn('order_weight',orders['order_number']/orders['max_order'])\\\n                .withColumn('time_weight',orders['days']/orders['max_days'] )\\\n                .select('user_id','order_id','eval_set', 'order_number','days_since_prior_order','days','max_order','max_days','order_weight','time_weight')\\\n                .sort(\"user_id\", 'order_number')\norders.createOrReplaceTempView(\"orders\")\n","user":"anonymous","dateUpdated":"2017-07-23T22:43:54-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500757041605_-2128991884","id":"20170722-135721_1893998135","dateCreated":"2017-07-22T13:57:21-0700","dateStarted":"2017-07-23T21:36:27-0700","dateFinished":"2017-07-23T21:39:05-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3003"},{"text":"%spark.pyspark\norders.toPandas().to_csv('/data/Instacart/spark/orders_spark.csv',index=False)\n","user":"anonymous","dateUpdated":"2017-07-23T22:44:11-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1500875037097_1126471207","id":"20170723-224357_410525545","dateCreated":"2017-07-23T22:43:57-0700","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3004"},{"text":"%spark.pyspark\norders = spark.read.csv('/data/Instacart/spark/orders_spark.csv', header= True, inferSchema=True)\norders.show(5)\n","user":"anonymous","dateUpdated":"2017-07-24T21:47:45-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------+--------+------------+----------------------+-----+---------+--------+-------------------+-------------------+\n|user_id|order_id|eval_set|order_number|days_since_prior_order| days|max_order|max_days|       order_weight|        time_weight|\n+-------+--------+--------+------------+----------------------+-----+---------+--------+-------------------+-------------------+\n|      1| 2539329|   prior|           1|                  null|  0.0|       11|   190.0|0.09090909090909091|                0.0|\n|      1| 2398795|   prior|           2|                  15.0| 43.0|       11|   190.0|0.18181818181818182|0.22631578947368422|\n|      1|  473747|   prior|           3|                  21.0|103.0|       11|   190.0| 0.2727272727272727| 0.5421052631578948|\n|      1| 2254736|   prior|           4|                  29.0|160.0|       11|   190.0|0.36363636363636365| 0.8421052631578947|\n|      1|  431534|   prior|           5|                  28.0|131.0|       11|   190.0|0.45454545454545453| 0.6894736842105263|\n+-------+--------+--------+------------+----------------------+-----+---------+--------+-------------------+-------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500871344744_610549997","id":"20170723-214224_316126987","dateCreated":"2017-07-23T21:42:24-0700","dateStarted":"2017-07-24T21:48:01-0700","dateFinished":"2017-07-24T21:48:21-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3005"},{"text":"%spark.pyspark\n\nprior_orders = priors.join(orders, on=['order_id'], how = 'left')\nprior_orders = prior_orders.withColumn('p_time_0',F.lit(1))\nprior_orders.createOrReplaceTempView(\"prior_orders\")\nprior_orders = spark.sql(\"SELECT *, sum(p_time_0) over (PARTITION BY user_id, product_id ORDER BY order_number) as p_time,  LAG(days,1) OVER (PARTITION BY user_id, product_id ORDER BY order_number) as pre_days  From prior_orders \")\nprior_orders.show(5)\n\nprior_orders = prior_orders.withColumn('weight', 1/prior_orders['add_to_cart_order'])\\\n                            .withColumn('gap', prior_orders['pre_days'] - prior_orders['days'])\\\n                            .drop('p_time_0','pre_days')\nprior_orders.show(5)\n                             \n# prior_orders = prior_orders.sort('user_id', 'product_id', 'order_number')","user":"anonymous","dateUpdated":"2017-07-24T20:20:43-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+--------+------+--------+\n|order_id|product_id|add_to_cart_order|reordered|user_id|eval_set|order_number|days_since_prior_order| days|max_order|max_days|       order_weight|       time_weight|p_time_0|p_time|pre_days|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+--------+------+--------+\n|  280530|     47167|               21|        0|      9|   prior|           1|                  null|  0.0|        4|    66.0|               0.25|               0.0|       1|     1|    null|\n| 2505309|      4210|               23|        0|     14|   prior|           7|                  30.0|276.0|       14|   276.0|                0.5|               1.0|       1|     1|    null|\n| 1491849|     48171|               12|        0|     16|   prior|           3|                  21.0| 60.0|        7|   116.0|0.42857142857142855|0.5172413793103449|       1|     1|    null|\n| 1321974|      5209|                7|        0|     19|   prior|           1|                  null|  0.0|       10|    84.0|                0.1|               0.0|       1|     1|    null|\n| 2474845|      5209|               14|        1|     19|   prior|           6|                  20.0| 84.0|       10|    84.0|                0.6|               1.0|       1|     2|     0.0|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+--------+------+--------+\nonly showing top 5 rows\n\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+------+--------------------+-----+\n|order_id|product_id|add_to_cart_order|reordered|user_id|eval_set|order_number|days_since_prior_order| days|max_order|max_days|       order_weight|       time_weight|p_time|              weight|  gap|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+------+--------------------+-----+\n|  280530|     47167|               21|        0|      9|   prior|           1|                  null|  0.0|        4|    66.0|               0.25|               0.0|     1|0.047619047619047616| null|\n| 2505309|      4210|               23|        0|     14|   prior|           7|                  30.0|276.0|       14|   276.0|                0.5|               1.0|     1|0.043478260869565216| null|\n| 1491849|     48171|               12|        0|     16|   prior|           3|                  21.0| 60.0|        7|   116.0|0.42857142857142855|0.5172413793103449|     1| 0.08333333333333333| null|\n| 1321974|      5209|                7|        0|     19|   prior|           1|                  null|  0.0|       10|    84.0|                0.1|               0.0|     1| 0.14285714285714285| null|\n| 2474845|      5209|               14|        1|     19|   prior|           6|                  20.0| 84.0|       10|    84.0|                0.6|               1.0|     2| 0.07142857142857142|-84.0|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+-------------------+------------------+------+--------------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500876182341_-873061725","id":"20170723-230302_167979898","dateCreated":"2017-07-23T23:03:02-0700","dateStarted":"2017-07-24T20:20:58-0700","dateFinished":"2017-07-24T20:32:06-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3006"},{"text":"%spark.pyspark\nprior_orders.write.csv('/data/Instacart/spark/prior_orders_spark.csv', header=True)\n         \n#prior_orders.toPandas().to_csv('/data/Instacart/spark/prior_orders_spark.csv',index=False)","user":"anonymous","dateUpdated":"2017-07-24T20:20:50-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500873296405_202393005","id":"20170723-221456_667098812","dateCreated":"2017-07-23T22:14:56-0700","dateStarted":"2017-07-24T20:21:20-0700","dateFinished":"2017-07-24T20:41:47-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3007"},{"text":"%spark.pyspark\nprior_orders = spark.read.csv('/data/Instacart/spark/prior_orders_spark.csv', header= True, inferSchema=True)\nprior_orders.show(5)","user":"anonymous","dateUpdated":"2017-07-24T23:06:35-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+------------------+--------------------+------+-------------------+------+\n|order_id|product_id|add_to_cart_order|reordered|user_id|eval_set|order_number|days_since_prior_order| days|max_order|max_days|      order_weight|         time_weight|p_time|             weight|   gap|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+------------------+--------------------+------+-------------------+------+\n| 1199898|     18523|               15|        0|      2|   prior|           6|                  13.0| 69.0|       15|   228.0|               0.4|  0.3026315789473684|     1|0.06666666666666667|  null|\n| 1718559|     18523|               15|        1|      2|   prior|           9|                   8.0| 33.0|       15|   228.0|               0.6| 0.14473684210526316|     2|0.06666666666666667|  36.0|\n| 1447487|     18523|                5|        1|      2|   prior|          10|                   6.0|  9.0|       15|   228.0|0.6666666666666666|0.039473684210526314|     3|                0.2|  24.0|\n| 1402090|     18523|                5|        1|      2|   prior|          11|                  30.0|228.0|       15|   228.0|0.7333333333333333|                 1.0|     4|                0.2|-219.0|\n| 3186735|     18523|               12|        1|      2|   prior|          12|                  28.0|138.0|       15|   228.0|               0.8|  0.6052631578947368|     5|0.08333333333333333|  90.0|\n+--------+----------+-----------------+---------+-------+--------+------------+----------------------+-----+---------+--------+------------------+--------------------+------+-------------------+------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500870155798_584066385","id":"20170723-212235_1062243092","dateCreated":"2017-07-23T21:22:35-0700","dateStarted":"2017-07-24T23:06:35-0700","dateFinished":"2017-07-24T23:09:32-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3008"},{"text":"%spark.pyspark\n\n\nproducts = prior_orders.groupBy(['product_id']).agg(F.count('order_id').alias('order_total'), \\\n                                                    F.sum('reordered').alias('reorder_total'), \\\n                                                    F.countDistinct('user_id').alias('unique_user'),\\\n                                                    F.mean('weight').alias('product_weight_mean'),\\\n                                                    F.max('weight').alias('product_weight_max'),\\\n                                                    F.min('weight').alias('product_weight_min'),\\\n                                                    F.stddev('weight').alias('product_weight_std'),\\\n                                                    F.mean('order_weight').alias('product_order_weight_mean'),\\\n                                                    F.max('order_weight').alias('product_order_weight_max'),\\\n                                                    F.min('order_weight').alias('product_order_weight_min'),\n                                                    F.stddev('order_weight').alias('product_order_weight_std'),\\\n                                                    F.mean('time_weight').alias('product_time_weight_mean'),\\\n                                                    F.max('time_weight').alias('product_time_weight_max'),\\\n                                                    F.min('time_weight').alias('product_time_weight_min'),\n                                                    F.stddev('time_weight').alias('product_time_weight_std'),\\\n                                                    F.mean('p_time').alias('product_p_time_mean'),\\\n                                                    F.max('p_time').alias('product_p_time_max'),\\\n                                                    F.min('p_time').alias('product_p_time_min'),\\\n                                                    F.stddev('p_time').alias('product_p_time_std'),\\\n                                                    F.mean('days').alias('product_days_mean'),\\\n                                                    F.max('days').alias('product_days_max'),\\\n                                                    F.min('days').alias('product_days_min'),\\\n                                                    F.stddev('days').alias('product_days_std'),\\\n                                                    F.mean('gap').alias('product_gap_mean'),\\\n                                                    F.min('gap').alias('product_gap_min'),\\\n                                                    F.max('gap').alias('product_gap_max'),\\\n                                                    F.stddev('gap').alias('product_gap_std')\n                                                    )\n\n# products1 = prior_orders.filter(prior_orders['p_time'] == 1).groupBy(['product_id']).agg(F.count('p_time').alias('first_time_count'))\n# products2 = prior_orders.filter(prior_orders['p_time'] == 2).groupBy(['product_id']).agg(F.count('p_time').alias('second_time_count'))\nproducts3 = prior_orders.filter(prior_orders['reordered']==1).groupBy(['product_id']).agg(F.countDistinct('user_id').alias('unique_reorder_user'))\n\n# products = products.join(products1, on = ['product_id'], how = 'left')\\\n#                   .join(products2, on = ['product_id'], how = 'left')\\\n#                   .join(products3, on = ['product_id'], how = 'left')\n\nproducts = products.join(products3, on = ['product_id'], how = 'left')\n# products = products.withColumn('reorder_prob', products['second_time_count']/products['first_time_count'])\\\n#                     .withColumn('reorder_ratio', products['reorder_total']/products['order_total'])\\\n#                     .withColumn('reorder_time', 1+products['reorder_total']/products['first_time_count'])\\\n#                     .withColumn('user_reorder_ratio', products['unique_user']/products['unique_reorder_user'])\n\nproducts = products.withColumn('reorder_ratio', products['reorder_total']/products['order_total'])\\\n                    .withColumn('reorder_time', 1+products['reorder_total']/products['unique_user'])\\\n                    .withColumn('user_reorder_ratio', products['unique_user']/products['unique_reorder_user'])\nproducts = products.withColumn('reorder_time2', products['reorder_total']/products['unique_reorder_user'])\n\nproducts.show(5)\n","user":"anonymous","dateUpdated":"2017-07-24T20:44:16-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\n|product_id|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max|  product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min| product_p_time_std| product_days_mean|product_days_max|product_days_min| product_days_std|   product_gap_mean|product_gap_min|product_gap_max|   product_gap_std|unique_reorder_user|      reorder_ratio|      reorder_time|user_reorder_ratio|     reorder_time2|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\n|       148|       4903|         2778|       2125| 0.2028631305165572|               1.0| 0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1|  5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|                887| 0.5665918825209055| 2.307294117647059| 2.395715896279594|3.1319052987598646|\n|       463|         32|            4|         28|0.31017084614946455|               1.0| 0.03571428571428571|0.32714220024079865|       0.6322498456856916|      0.9230769230769231|     0.28888888888888886|      0.1689303262259435|     0.31495806770120427|                    1.0|   0.005494505494505495|    0.30088269442020293|             1.3125|                 5|                 1| 0.9310937030562325|           67.8125|           214.0|             2.0|57.16667058528468|             -46.75|         -116.0|           68.0| 81.67159849054015|                  1|              0.125|1.1428571428571428|              28.0|               4.0|\n|       471|        138|           78|         60|0.31856784679997896|               1.0|0.020833333333333332|0.34039080480460204|       0.5484398800062109|                    0.99|                    0.01|      0.2732781985704871|     0.41150502609280243|                    1.0|                    0.0|    0.35506662972161845|  3.289855072463768|                16|                 1|   3.40073607006759| 97.60144927536231|           338.0|             0.0|89.55987597549243|-12.846153846153847|         -284.0|          265.0|109.48902298333907|                 25| 0.5652173913043478|               2.3|               2.4|              3.12|\n|       496|         37|           14|         23| 0.3258660128225346|               1.0|0.043478260869565216|0.34943719674657076|        0.428497567394429|      0.9428571428571428|     0.02857142857142857|     0.26779827723890004|      0.3437662002427728|                    1.0|                    0.0|    0.31102605952887497| 1.5945945945945945|                 4|                 1| 0.8647240876416868| 78.13513513513513|           297.0|             0.0|81.52885043623179|              -17.0|         -256.0|          123.0|105.33828290870251|                  7| 0.3783783783783784| 1.608695652173913|3.2857142857142856|               2.0|\n|       833|         12|            1|         11|0.35420274170274174|               1.0| 0.08333333333333333|0.26564042594761084|       0.6692023821786327|      0.7894736842105263|                     0.4|     0.13329771003600355|      0.4760017225703271|                    1.0|    0.04297994269340974|    0.38728547496753896| 1.0833333333333333|                 2|                 1|0.28867513459481287|            107.25|           279.0|            15.0|90.44046258576563|             -123.0|         -123.0|         -123.0|               NaN|                  1|0.08333333333333333|1.0909090909090908|              11.0|               1.0|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500846602624_478538432","id":"20170723-145002_818532148","dateCreated":"2017-07-23T14:50:02-0700","dateStarted":"2017-07-24T20:44:16-0700","dateFinished":"2017-07-24T20:58:07-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3009"},{"text":"%spark.pyspark\nproducts.toPandas().to_csv('/data/Instacart/spark/product1_spark.csv',index=False)\n#products.write.csv('/data/Instacart/spark/products1_spark.csv', header=True)","user":"anonymous","dateUpdated":"2017-07-24T20:44:32-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500915826224_-416395274","id":"20170724-100346_527256393","dateCreated":"2017-07-24T10:03:46-0700","dateStarted":"2017-07-24T20:44:32-0700","dateFinished":"2017-07-24T21:14:05-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3010"},{"text":"%spark.pyspark\nproducts = spark.read.csv('/data/Instacart/spark/product1_spark.csv', header= True, inferSchema=True)\nproducts.show(5)","user":"anonymous","dateUpdated":"2017-07-24T21:14:11-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\n|product_id|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max|  product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min| product_p_time_std| product_days_mean|product_days_max|product_days_min| product_days_std|   product_gap_mean|product_gap_min|product_gap_max|   product_gap_std|unique_reorder_user|      reorder_ratio|      reorder_time|user_reorder_ratio|     reorder_time2|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\n|       148|       4903|         2778|       2125| 0.2028631305165572|               1.0| 0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1|  5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0| 0.5665918825209055| 2.307294117647059| 2.395715896279594|3.1319052987598646|\n|       463|         32|            4|         28|0.31017084614946455|               1.0| 0.03571428571428571|0.32714220024079865|       0.6322498456856916|      0.9230769230769231|     0.28888888888888886|      0.1689303262259435|     0.31495806770120427|                    1.0|   0.005494505494505495|    0.30088269442020293|             1.3125|                 5|                 1| 0.9310937030562325|           67.8125|           214.0|             2.0|57.16667058528468|             -46.75|         -116.0|           68.0| 81.67159849054015|                1.0|              0.125|1.1428571428571428|              28.0|               4.0|\n|       471|        138|           78|         60|0.31856784679997896|               1.0|0.020833333333333332|0.34039080480460204|       0.5484398800062109|                    0.99|                    0.01|      0.2732781985704871|     0.41150502609280243|                    1.0|                    0.0|    0.35506662972161845|  3.289855072463768|                16|                 1|   3.40073607006759| 97.60144927536231|           338.0|             0.0|89.55987597549243|-12.846153846153847|         -284.0|          265.0|109.48902298333907|               25.0| 0.5652173913043478|               2.3|               2.4|              3.12|\n|       496|         37|           14|         23| 0.3258660128225346|               1.0|0.043478260869565216|0.34943719674657076|        0.428497567394429|      0.9428571428571428|     0.02857142857142857|     0.26779827723890004|      0.3437662002427728|                    1.0|                    0.0|    0.31102605952887497| 1.5945945945945945|                 4|                 1| 0.8647240876416868| 78.13513513513513|           297.0|             0.0|81.52885043623179|              -17.0|         -256.0|          123.0|105.33828290870251|                7.0| 0.3783783783783784| 1.608695652173913|3.2857142857142856|               2.0|\n|       833|         12|            1|         11|0.35420274170274174|               1.0| 0.08333333333333333|0.26564042594761084|       0.6692023821786327|      0.7894736842105263|                     0.4|     0.13329771003600355|      0.4760017225703271|                    1.0|    0.04297994269340974|    0.38728547496753896| 1.0833333333333333|                 2|                 1|0.28867513459481287|            107.25|           279.0|            15.0|90.44046258576563|             -123.0|         -123.0|         -123.0|              null|                1.0|0.08333333333333333|1.0909090909090908|              11.0|               1.0|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500954449649_-128832206","id":"20170724-204729_1112787111","dateCreated":"2017-07-24T20:47:29-0700","dateStarted":"2017-07-24T21:14:11-0700","dateFinished":"2017-07-24T21:14:11-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3011"},{"text":"%spark.pyspark\nfilepath4 = '/data/Instacart/products.csv'\nproduct0 = spark.read.csv(filepath4, header= True, inferSchema=True)\nproduct0.show(5)\n\n","user":"anonymous","dateUpdated":"2017-07-24T21:14:35-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+--------------------+--------+-------------+\n|product_id|        product_name|aisle_id|department_id|\n+----------+--------------------+--------+-------------+\n|         1|Chocolate Sandwic...|      61|           19|\n|         2|    All-Seasons Salt|     104|           13|\n|         3|Robust Golden Uns...|      94|            7|\n|         4|Smart Ones Classi...|      38|            1|\n|         5|Green Chile Anyti...|       5|           13|\n+----------+--------------------+--------+-------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500832616036_-2064724753","id":"20170723-105656_1193056177","dateCreated":"2017-07-23T10:56:56-0700","dateStarted":"2017-07-24T21:14:35-0700","dateFinished":"2017-07-24T21:14:35-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3012"},{"text":"%spark.pyspark\naisle1 = prior_orders.join(product0.select('product_id','aisle_id'), on = 'product_id', how = 'left')\\\n                       .groupBy('aisle_id').agg(F.count('order_number').alias('aisle_product_total'),\\\n                                                F.countDistinct('user_id').alias('aisle_unique_user'),\\\n                                                F.mean('gap').alias('aisle_gap_mean'),\\\n                                                F.min('gap').alias('aisle_gap_min'),\\\n                                                F.max('gap').alias('aisle_gap_max'),\\\n                                                F.stddev('gap').alias('aisle_gap_std'))\n                                                \naisle2 = prior_orders.filter(prior_orders['reordered']==1).join(product0.select('product_id','aisle_id'), on = 'product_id', how = 'left')\\\n                       .groupBy('aisle_id').agg(F.count('order_number').alias('aisle_product_reorder_total'),\\\n                                                F.countDistinct('user_id').alias('aisle_unique_reorder_user'))\naisle1 = aisle1.join(aisle2, on = ['aisle_id'], how = 'left')\naisle1 = aisle1.withColumn('aisle_product_reorder_ratio', aisle1['aisle_product_total']/aisle1['aisle_product_reorder_total'] )\naisle1 = aisle1.withColumn('aisler_user_reorder_ratio', aisle1['aisle_unique_user']/aisle1['aisle_unique_reorder_user'])\naisle1 = aisle1.withColumn('aisler_user_reorder_time', aisle1['aisle_product_reorder_total']/aisle1['aisle_unique_reorder_user'])\naisle1 = aisle1.drop('aisle_product_total','aisle_unique_user','aisle_product_reorder_total','aisle_unique_reorder_user')\n\n# aisle1 .show(5)\n             \n","user":"anonymous","dateUpdated":"2017-07-24T21:14:38-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500832842909_340895581","id":"20170723-110042_1959721093","dateCreated":"2017-07-23T11:00:42-0700","dateStarted":"2017-07-24T21:14:38-0700","dateFinished":"2017-07-24T21:14:38-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3013"},{"text":"%spark.pyspark\ndept1 = prior_orders.join(product0.select('product_id','department_id'), on = 'product_id', how = 'left')\\\n                    .groupBy('department_id').agg(F.count('order_number').alias('dept_product_total'),\\\n                                                  F.countDistinct('user_id').alias('dept_unique_user'),\\\n                                                  F.mean('gap').alias('dept_gap_mean'),\\\n                                                  F.min('gap').alias('dept_gap_min'),\\\n                                                  F.max('gap').alias('dept_gap_max'),\\\n                                                  F.stddev('gap').alias('dept_gap_std'))\n                                                  \ndept2 = prior_orders.filter(prior_orders['reordered']==1).join(product0.select('product_id','department_id'), on = 'product_id', how = 'left')\\\n                    .groupBy('department_id').agg(F.count('order_number').alias('dept_product_reorder_total'),\\\n                                                  F.countDistinct('user_id').alias('dept_unique_reorder_user'))\ndept1 = dept1.join(dept2, on = ['department_id'], how = 'left')\ndept1 = dept1.withColumn('dept_product_reorder_ratio', dept1['dept_product_total']/dept1['dept_product_reorder_total'] )\ndept1 = dept1.withColumn('dept_user_reorder_ratio', dept1['dept_unique_user']/dept1['dept_unique_reorder_user'])\ndept1 = dept1.withColumn('dept_user_reorder_time',dept1['dept_product_reorder_total']/dept1['dept_unique_reorder_user'] )\ndept1 = dept1.drop('dept_product_total','dept_unique_user','dept_product_reorder_total','dept_unique_reorder_user')\n             \n# dept1.show(5)","user":"anonymous","dateUpdated":"2017-07-24T21:14:40-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500836010098_1486352112","id":"20170723-115330_656180622","dateCreated":"2017-07-23T11:53:30-0700","dateStarted":"2017-07-24T21:14:40-0700","dateFinished":"2017-07-24T21:14:40-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3014"},{"text":"%spark.pyspark\nproduct0 = product0.join(aisle1, on = 'aisle_id', how = 'left').join(dept1, on = 'department_id', how = 'left')\\\n                   .drop('aisle_id', 'department_id', 'product_name' )\n# product0.show(5)\n\n\n                   ","user":"anonymous","dateUpdated":"2017-07-24T21:14:43-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500840504629_-1081909443","id":"20170723-130824_581343664","dateCreated":"2017-07-23T13:08:24-0700","dateStarted":"2017-07-24T21:14:43-0700","dateFinished":"2017-07-24T21:14:44-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3015"},{"text":"%spark.pyspark\nproduct0.toPandas().to_csv('/data/Instacart/spark/product0_spark.csv',index=False)\n# product0.write.csv('/data/Instacart/spark/product0_spark.csv', header = True)","user":"anonymous","dateUpdated":"2017-07-24T21:14:48-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500917885157_-1085331881","id":"20170724-103805_644933","dateCreated":"2017-07-24T10:38:05-0700","dateStarted":"2017-07-24T21:14:48-0700","dateFinished":"2017-07-24T21:30:48-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3016"},{"text":"%spark.pyspark\nproduct0 = spark.read.csv('/data/Instacart/spark/product0_spark.csv', header= True, inferSchema=True)\nproduct0.show(5)\n","user":"anonymous","dateUpdated":"2017-07-24T21:32:31-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|product_id|     aisle_gap_mean|aisle_gap_min|aisle_gap_max|     aisle_gap_std|aisle_product_reorder_ratio|aisler_user_reorder_ratio|aisler_user_reorder_time|     dept_gap_mean|dept_gap_min|dept_gap_max|      dept_gap_std|dept_product_reorder_ratio|dept_user_reorder_ratio|dept_user_reorder_time|\n+----------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|        39|-5.4472507391284966|       -363.0|        361.0|112.53960113098704|         1.5393929489369922|       1.9664709979106556|       6.696746592378868|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n|       266|-5.4472507391284966|       -363.0|        361.0|112.53960113098704|         1.5393929489369922|       1.9664709979106556|       6.696746592378868|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n|       345|-5.4472507391284966|       -363.0|        361.0|112.53960113098704|         1.5393929489369922|       1.9664709979106556|       6.696746592378868|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n|       693|-5.4472507391284966|       -363.0|        361.0|112.53960113098704|         1.5393929489369922|       1.9664709979106556|       6.696746592378868|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n|       788|-5.4472507391284966|       -363.0|        361.0|112.53960113098704|         1.5393929489369922|       1.9664709979106556|       6.696746592378868|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n+----------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500956136026_1702176298","id":"20170724-211536_1740133764","dateCreated":"2017-07-24T21:15:36-0700","dateStarted":"2017-07-24T21:32:31-0700","dateFinished":"2017-07-24T21:32:31-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3017"},{"text":"%spark.pyspark\nproducts_all = products.join(product0, on = 'product_id', how = 'left')\n# products_all.show(5)\n","user":"anonymous","dateUpdated":"2017-07-24T21:32:39-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500913390477_248756786","id":"20170724-092310_244389744","dateCreated":"2017-07-24T09:23:10-0700","dateStarted":"2017-07-24T21:32:39-0700","dateFinished":"2017-07-24T21:32:40-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3018"},{"text":"%spark.pyspark\nproducts_all.toPandas().to_csv('/data/Instacart/spark/products_all_spark.csv',index=False)\n# products_all.write.csv('/data/Instacart/spark/products_all_spark.csv')","user":"anonymous","dateUpdated":"2017-07-24T21:33:13-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500875420920_515796961","id":"20170723-225020_951631188","dateCreated":"2017-07-23T22:50:20-0700","dateStarted":"2017-07-24T21:33:13-0700","dateFinished":"2017-07-24T21:33:20-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3019"},{"text":"%spark.pyspark\nproducts_all =  spark.read.csv('/data/Instacart/spark/products_all_spark.csv', header= True, inferSchema=True)\nproducts_all.show(5)","user":"anonymous","dateUpdated":"2017-07-24T23:06:58-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|product_id|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max|  product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min| product_p_time_std| product_days_mean|product_days_max|product_days_min| product_days_std|   product_gap_mean|product_gap_min|product_gap_max|   product_gap_std|unique_reorder_user|      reorder_ratio|      reorder_time|user_reorder_ratio|     reorder_time2|     aisle_gap_mean|aisle_gap_min|aisle_gap_max|     aisle_gap_std|aisle_product_reorder_ratio|aisler_user_reorder_ratio|aisler_user_reorder_time|     dept_gap_mean|dept_gap_min|dept_gap_max|      dept_gap_std|dept_product_reorder_ratio|dept_user_reorder_ratio|dept_user_reorder_time|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|       148|       4903|         2778|       2125| 0.2028631305165572|               1.0| 0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1|  5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0| 0.5665918825209055| 2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429| -4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n|       463|         32|            4|         28|0.31017084614946455|               1.0| 0.03571428571428571|0.32714220024079865|       0.6322498456856916|      0.9230769230769231|     0.28888888888888886|      0.1689303262259435|     0.31495806770120427|                    1.0|   0.005494505494505495|    0.30088269442020293|             1.3125|                 5|                 1| 0.9310937030562325|           67.8125|           214.0|             2.0|57.16667058528468|             -46.75|         -116.0|           68.0| 81.67159849054015|                1.0|              0.125|1.1428571428571428|              28.0|               4.0|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n|       471|        138|           78|         60|0.31856784679997896|               1.0|0.020833333333333332|0.34039080480460204|       0.5484398800062109|                    0.99|                    0.01|      0.2732781985704871|     0.41150502609280243|                    1.0|                    0.0|    0.35506662972161845|  3.289855072463768|                16|                 1|   3.40073607006759| 97.60144927536231|           338.0|             0.0|89.55987597549243|-12.846153846153847|         -284.0|          265.0|109.48902298333907|               25.0| 0.5652173913043478|               2.3|               2.4|              3.12| -5.213331204962145|       -365.0|        365.0|119.81743938989965|         1.8953221441819452|       2.3553085982467015|       5.824670149650226|-5.432206301638553|      -365.0|       365.0|116.21695810976719|        1.5303152867184104|      1.340774536961599|    13.640075420750017|\n|       496|         37|           14|         23| 0.3258660128225346|               1.0|0.043478260869565216|0.34943719674657076|        0.428497567394429|      0.9428571428571428|     0.02857142857142857|     0.26779827723890004|      0.3437662002427728|                    1.0|                    0.0|    0.31102605952887497| 1.5945945945945945|                 4|                 1| 0.8647240876416868| 78.13513513513513|           297.0|             0.0|81.52885043623179|              -17.0|         -256.0|          123.0|105.33828290870251|                7.0| 0.3783783783783784| 1.608695652173913|3.2857142857142856|               2.0| -6.702716796162069|       -359.0|        358.0|119.09100516357486|         2.2604161234812534|         3.26281512605042|       4.028781512605042|-8.337352520407304|      -365.0|       364.0|122.68964497730116|         2.486452915930321|      2.247306848156575|     5.981817449610374|\n|       833|         12|            1|         11|0.35420274170274174|               1.0| 0.08333333333333333|0.26564042594761084|       0.6692023821786327|      0.7894736842105263|                     0.4|     0.13329771003600355|      0.4760017225703271|                    1.0|    0.04297994269340974|    0.38728547496753896| 1.0833333333333333|                 2|                 1|0.28867513459481287|            107.25|           279.0|            15.0|90.44046258576563|             -123.0|         -123.0|         -123.0|              null|                1.0|0.08333333333333333|1.0909090909090908|              11.0|               1.0| -5.195104257949197|       -365.0|        365.0|117.73474579106245|         1.7443083226454186|       2.0431953924914676|       6.126031001137656|-5.821769112042235|      -365.0|       365.0|118.52122309291707|        1.7416146101293568|     1.4254191109692937|    13.565147312698919|\n+----------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+-------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+-------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500869335643_-3053335","id":"20170723-210855_151305697","dateCreated":"2017-07-23T21:08:55-0700","dateStarted":"2017-07-24T23:06:58-0700","dateFinished":"2017-07-24T23:09:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3020"},{"text":"%spark.pyspark\nuser01 = prior_orders.filter(prior_orders['reordered']==1).groupBy('user_id')\\\n                     .agg(F.sum('reordered').alias('user_total_reorder_product'),\\\n                          F.countDistinct('product_id').alias('user_distinct_reorder_product'))\n                             \nprior_order_sec =  prior_orders.filter(prior_orders['order_number']>1)                             \nuser02 =prior_order_sec.groupBy('user_id')\\\n                      .agg(F.count('reordered').alias('user_total_sec_order_products'))\n\nuser0 = user01.join(user02, on =['user_id'], how = 'outer')\nuser0 = user0.withColumn('user_reorder_ratio2', user0['user_total_reorder_product']/user0['user_total_sec_order_products'])\n\nuser03 = prior_order_sec.groupBy('user_id', 'order_id').agg(F.count('product_id').alias('product_per_order'),\\\n                                                            F.sum('reordered').alias('product_reorder_per_order'))\nuser03 = user03.withColumn('reorder_ratio_per_order', user03['product_reorder_per_order']/user03['product_per_order'] )\n\nuser03 = user03.groupby('user_id').agg(F.mean('reorder_ratio_per_order').alias('user_mean_reorder_ratio_per_order'),\\\n                                       F.min('reorder_ratio_per_order').alias('user_min_reorder_ratio_per_order'),\\\n                                       F.max('reorder_ratio_per_order').alias('user_max_reorder_ratio_per_order'),\\\n                                       F.stddev('reorder_ratio_per_order').alias('user_std_reorder_ratio_per_order'))\n                                        \nusers = orders.groupBy('user_id').agg(F.max('order_number').alias('user_total_order'),\\\n                                      F.sum('days_since_prior_order').alias('user_sum_days_since_prior_order'),\\\n                                      F.mean('days_since_prior_order').alias('user_mean_days_since_prior_order'),\\\n                                      F.stddev('days_since_prior_order').alias('user_std_days_since_prior_order'),\\\n                                      F.max('days_since_prior_order').alias('user_max_days_since_prior_order'),\\\n                                      F.min('days_since_prior_order').alias('user_min_days_since_prior_order') )\n                            \nusers2 = prior_orders.groupBy('user_id').agg( F.count('product_id').alias('user_total_products'),\\\n                                              F.countDistinct('product_id').alias('user_distinct_product'),\\\n                                              F.mean('gap').alias('user_gap_mean'),\\\n                                              F.min('gap').alias('user_gap_min'),\\\n                                              F.max('gap').alias('user_gap_max'),\\\n                                              F.stddev('gap').alias('user_gap_std'))\n\nusers = users.join(user0, on =['user_id'], how = 'left')\\\n             .join(users2, on =['user_id'], how = 'left')\\\n             .join(user03, on = ['user_id'], how = 'left')\n             \nusers = users.withColumn('user_average_basket', users['user_total_products']/users['user_total_order'])\\\n             .withColumn('user_distinct_product_reorder_ratio', users['user_distinct_reorder_product']/users['user_distinct_product'])\n\nusers1 = orders.filter(orders['eval_set']!=\"prior\")\\\n               .select('user_id','order_id','eval_set', 'days_since_prior_order')\\\n               .withColumnRenamed('days_since_prior_order', 'time_since_last_order')\n\nusers = users.join(users1, on =['user_id'], how = 'left')\n\n\n","user":"anonymous","dateUpdated":"2017-07-24T23:07:26-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500868425904_-573893700","id":"20170723-205345_1797087296","dateCreated":"2017-07-23T20:53:45-0700","dateStarted":"2017-07-24T21:51:04-0700","dateFinished":"2017-07-24T21:51:04-0700","status":"ABORT","progressUpdateIntervalMs":500,"$$hashKey":"object:3021"},{"text":"%spark.pyspark\n# users.write.csv('/data/Instacart/spark/users_all_spark.csv')\nusers.toPandas().to_csv('/data/Instacart/spark/users_all_spark.csv', index = False)","user":"anonymous","dateUpdated":"2017-07-24T21:51:08-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500875453719_881354388","id":"20170723-225053_2064774029","dateCreated":"2017-07-23T22:50:53-0700","dateStarted":"2017-07-24T21:51:08-0700","dateFinished":"2017-07-24T22:12:06-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3022"},{"text":"%spark.pyspark\nusers =  spark.read.csv('/data/Instacart/spark/users_all_spark.csv', header= True, inferSchema=True)\nusers.show(5)","user":"anonymous","dateUpdated":"2017-07-24T23:07:05-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+\n|user_id|user_total_order|user_sum_days_since_prior_order|user_mean_days_since_prior_order|user_std_days_since_prior_order|user_max_days_since_prior_order|user_min_days_since_prior_order|user_total_reorder_product|user_distinct_reorder_product|user_total_sec_order_products|user_reorder_ratio2|user_total_products|user_distinct_product|      user_gap_mean|user_gap_min|user_gap_max|      user_gap_std|user_mean_reorder_ratio_per_order|user_min_reorder_ratio_per_order|user_max_reorder_ratio_per_order|user_std_reorder_ratio_per_order|user_average_basket|user_distinct_product_reorder_ratio|order_id|eval_set|time_since_last_order|\n+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+\n|    148|               8|                           69.0|               9.857142857142858|              12.78578079259106|                           30.0|                            1.0|                      18.0|                         13.0|                           64|            0.28125|                103|                   85| -8.666666666666666|       -12.0|         0.0| 5.530663187549722|              0.22987012987012986|                             0.0|              0.6363636363636364|             0.30604744119570554|             12.875|                0.15294117647058825| 3348216|   train|                 27.0|\n|    463|               8|                          133.0|                            19.0|               9.72967967955095|                           30.0|                            4.0|                      23.0|                         15.0|                           80|             0.2875|                 85|                   62|-3.9130434782608696|      -133.0|       129.0| 77.90023517497367|               0.3259259259259259|                             0.0|                             1.0|              0.3607548099773733|             10.625|                0.24193548387096775| 1493300|    test|                 25.0|\n|    471|               7|                           65.0|              10.833333333333334|              4.355073669487885|                           16.0|                            5.0|                      39.0|                         25.0|                          100|               0.39|                125|                   86|-28.256410256410255|       -65.0|        18.0|25.556663513309474|               0.3682828282828283|                           0.125|                           0.625|              0.1870699673556944| 17.857142857142858|                0.29069767441860467|  417305|   train|                 10.0|\n|    496|              83|                          280.0|              3.4146341463414633|             1.8721560787010159|                            8.0|                            0.0|                     344.0|                         54.0|                          443| 0.7765237020316027|                452|                  108| 1.7005813953488371|      -239.0|       239.0|107.60176767983067|               0.8485145674143495|             0.09090909090909091|                             1.0|              0.2400364154626508|  5.445783132530121|                                0.5| 3387692|    test|                  2.0|\n|    833|              12|                          233.0|              21.181818181818183|              9.217572151257421|                           30.0|                            6.0|                      82.0|                         42.0|                          195| 0.4205128205128205|                219|                  137|-12.597560975609756|      -233.0|       227.0|144.61732045883636|                 0.44428633067077|             0.19047619047619047|              0.7857142857142857|              0.2131314176098862|              18.25|                0.30656934306569344|  683623|   train|                 22.0|\n+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500869027036_-896236133","id":"20170723-210347_709020483","dateCreated":"2017-07-23T21:03:47-0700","dateStarted":"2017-07-24T23:09:32-0700","dateFinished":"2017-07-24T23:09:36-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3023"},{"text":"%spark.pyspark\nuser_product=prior_orders.groupBy(['user_id','product_id']).agg( F.count('order_number').alias('up_order_count'),\\\n                                                    F.min('order_number').alias('up_first_order_number'),\\\n                                                    F.max('order_number').alias('up_last_order_number'),\\\n                                                    F.mean('add_to_cart_order').alias('up_average_cart_position'),\\\n                                                    F.sum('days').alias('days_sum'),\\\n                                                    F.min('days').alias('days_min'),\\\n                                                    F.max('days').alias('days_max'),\\\n                                                    F.stddev('days').alias('days_std'),\\\n                                                    # F.count('days').alias('days_count'),\\\n                                                    F.sum('time_weight').alias('time_weight_sum'),\\\n                                                    F.max('time_weight').alias('time_weight_max'),\\\n                                                    F.min('time_weight').alias('time_weight_min'),\\\n                                                    F.mean('time_weight').alias('time_weight_mean'),\\\n                                                    F.stddev('time_weight').alias('time_weight_std'),\\\n                                                    F.sum('weight').alias('weight_sum'),\\\n                                                    F.mean('weight').alias('weight_mean'),\\\n                                                    F.max('weight').alias('weight_max'),\\\n                                                    F.min('weight').alias('weight_min'),\\\n                                                    F.stddev('weight').alias('weight_std'),\\\n                                                    # F.max('order_weight').alias('order_weight_max'),\\\n                                                    # F.count('order_weight').alias('order_weight_count'),\\\n                                                    F.sum('order_weight').alias('order_weight_sum'),\\\n                                                    F.min('order_weight').alias('order_weight_min'),\\\n                                                    F.max('order_weight').alias('order_weight_max'),\\\n                                                    F.mean('order_weight').alias('order_weight_mean'),\\\n                                                    F.stddev('order_weight').alias('order_weight_std'),\\\n                                                    F.mean('gap').alias('gap_mean'),\\\n                                                    F.min('gap').alias('gap_min'),\\\n                                                    F.max('gap').alias('gap_max'),\\\n                                                    F.stddev('gap').alias('gap_std'))\n\nuser_product = user_product.join(users, on = 'user_id', how = 'left')\nuser_product = user_product.withColumn('up_order_rate', user_product['up_order_count']/user_product['user_total_order'])\\\n                            .withColumn('up_order_since_last_order', user_product['user_total_order'] - user_product['up_last_order_number'])\\\n                            .withColumn('up_order_rate_since_first_order', user_product['up_order_count']/(user_product['user_total_order'] - user_product['up_first_order_number']+1))\n                            # .withColumn('mean_gap', (user_product['days_max'] - user_product['days_min'])/np.maximum(1,user_product['days_count']-1))\nuser_product_all = user_product.join(products_all, on = 'product_id', how = 'left')\nuser_product_all.show(5)\n\n","user":"anonymous","dateUpdated":"2017-07-24T23:20:22-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+-------------------+--------------------+--------------------+------------------+------------------+-------------------+-------------------+--------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+-------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+-------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+------------------+-----------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-----------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|product_id|user_id|up_order_count|up_first_order_number|up_last_order_number|up_average_cart_position|days_sum|days_min|days_max|         days_std|   time_weight_sum|   time_weight_max|    time_weight_min|   time_weight_mean|    time_weight_std|         weight_sum|         weight_mean|         weight_max|          weight_min|          weight_std|  order_weight_sum|  order_weight_min|   order_weight_max|  order_weight_mean|    order_weight_std|gap_mean|gap_min|gap_max|           gap_std|user_total_order|user_sum_days_since_prior_order|user_mean_days_since_prior_order|user_std_days_since_prior_order|user_max_days_since_prior_order|user_min_days_since_prior_order|user_total_reorder_product|user_distinct_reorder_product|user_total_sec_order_products|user_reorder_ratio2|user_total_products|user_distinct_product|      user_gap_mean|user_gap_min|user_gap_max|      user_gap_std|user_mean_reorder_ratio_per_order|user_min_reorder_ratio_per_order|user_max_reorder_ratio_per_order|user_std_reorder_ratio_per_order|user_average_basket|user_distinct_product_reorder_ratio|order_id|eval_set|time_since_last_order|      up_order_rate|up_order_since_last_order|up_order_rate_since_first_order|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max| product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min|product_p_time_std| product_days_mean|product_days_max|product_days_min| product_days_std|   product_gap_mean|product_gap_min|product_gap_max|   product_gap_std|unique_reorder_user|     reorder_ratio|     reorder_time|user_reorder_ratio|     reorder_time2|     aisle_gap_mean|aisle_gap_min|aisle_gap_max|     aisle_gap_std|aisle_product_reorder_ratio|aisler_user_reorder_ratio|aisler_user_reorder_time|    dept_gap_mean|dept_gap_min|dept_gap_max|      dept_gap_std|dept_product_reorder_ratio|dept_user_reorder_ratio|dept_user_reorder_time|\n+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+-------------------+--------------------+--------------------+------------------+------------------+-------------------+-------------------+--------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+-------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+-------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+------------------+-----------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-----------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|       148|   6620|             3|                    6|                  17|      19.333333333333332|   249.0|     5.0|   191.0|96.56086163658648|0.7302052785923753|0.5601173020527859|0.01466275659824047|0.24340175953079177| 0.2831696822187287|0.18333333333333335|0.061111111111111116|                0.1|0.041666666666666664|0.033678765702728174|1.7619047619047619|0.2857142857142857| 0.8095238095238095| 0.5873015873015873|  0.2707733668132061|    93.0|   48.0|  138.0| 63.63961030678928|              21|                          341.0|                           17.05|              9.389103426733287|                           30.0|                            5.0|                     448.0|                         74.0|                          515| 0.8699029126213592|                546|                   98|  7.004464285714286|      -341.0|       336.0| 170.3564889088728|               0.8682587622366724|              0.4838709677419355|                             1.0|              0.1413250515357396|               26.0|                 0.7551020408163265|  328595|   train|                  9.0|0.14285714285714285|                        4|                         0.1875|       4903|         2778|       2125| 0.2028631305165572|               1.0|0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1| 5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0|0.5665918825209055|2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429|-4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n|       148|  40574|             4|                   25|                  37|                    3.75|   305.0|     0.0|   221.0|98.99621204874457|0.8379120879120879|0.6071428571428571|                0.0|0.20947802197802198|0.27196761551852905|              1.875|             0.46875|                1.0|               0.125|  0.3869619921043065|1.6933333333333334|0.3333333333333333|0.49333333333333335|0.42333333333333334| 0.06831300510639735|   -10.0| -221.0|  167.0|196.22181326244032|              75|                          364.0|               4.918918918918919|             3.9265752680677797|                           26.0|                            0.0|                     463.0|                         57.0|                          566| 0.8180212014134276|                573|                  110|-1.0302375809935205|      -312.0|       312.0|122.89600341401764|               0.8401376065961077|                           0.125|                             1.0|              0.2330765744222977|               7.64|                 0.5181818181818182|  204704|    test|                 26.0|0.05333333333333334|                       38|             0.0784313725490196|       4903|         2778|       2125| 0.2028631305165572|               1.0|0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1| 5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0|0.5665918825209055|2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429|-4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n|       148|  44906|             1|                   12|                  12|                    12.0|    68.0|    68.0|    68.0|              NaN|0.4594594594594595|0.4594594594594595| 0.4594594594594595| 0.4594594594594595|                NaN|0.08333333333333333| 0.08333333333333333|0.08333333333333333| 0.08333333333333333|                 NaN|0.6666666666666666|0.6666666666666666| 0.6666666666666666| 0.6666666666666666|                 NaN|    null|   null|   null|              null|              18|                          148.0|               8.705882352941176|              4.496730838653134|                           20.0|                            1.0|                      68.0|                         43.0|                          205|0.33170731707317075|                220|                  152|-20.352941176470587|      -143.0|        81.0| 49.18371430071543|               0.2900765625749641|                             0.0|              0.8235294117647058|             0.24407054713357637| 12.222222222222221|                0.28289473684210525| 2880962|    test|                  7.0|0.05555555555555555|                        6|            0.14285714285714285|       4903|         2778|       2125| 0.2028631305165572|               1.0|0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1| 5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0|0.5665918825209055|2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429|-4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n|       148|  68610|             3|                   82|                  88|       5.333333333333333|   292.0|    60.0|   130.0|35.23256069793017|0.9299363057324841|0.4140127388535032| 0.1910828025477707| 0.3099787685774947|0.11220560731824893| 0.6583333333333333| 0.21944444444444444| 0.3333333333333333|               0.125| 0.10551899951790321|              2.55|              0.82|               0.88|               0.85|0.030000000000000027|   -14.0|  -70.0|   42.0| 79.19595949289332|             100|                          314.0|              3.1717171717171717|             3.2483603526112073|                           17.0|                            0.0|                     473.0|                        108.0|                          647| 0.7310664605873262|                660|                  187|  8.894291754756871|      -314.0|       288.0|115.99390613182996|               0.7678909442564901|                             0.0|                             1.0|             0.24683071500746742|                6.6|                 0.5775401069518716| 2360208|   train|                  2.0|               0.03|                       12|            0.15789473684210525|       4903|         2778|       2125| 0.2028631305165572|               1.0|0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1| 5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0|0.5665918825209055|2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429|-4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n|       148|  96261|             1|                    1|                   1|                     9.0|     0.0|     0.0|     0.0|              NaN|               0.0|               0.0|                0.0|                0.0|                NaN| 0.1111111111111111|  0.1111111111111111| 0.1111111111111111|  0.1111111111111111|                 NaN|0.1111111111111111|0.1111111111111111| 0.1111111111111111| 0.1111111111111111|                 NaN|    null|   null|   null|              null|               9|                           72.0|                             9.0|              4.810702354423639|                           17.0|                            4.0|                     101.0|                         48.0|                          174| 0.5804597701149425|                208|                  107|-15.188118811881187|       -64.0|        47.0| 22.95984010017802|               0.5796786042787669|             0.45161290322580644|              0.7307692307692307|              0.1102525525783061|  23.11111111111111|                 0.4485981308411215|  430678|   train|                 11.0| 0.1111111111111111|                        8|             0.1111111111111111|       4903|         2778|       2125| 0.2028631305165572|               1.0|0.01818181818181818|0.21834037798944333|       0.4370730815970467|                    0.99|                    0.01|      0.2699885186995631|     0.39340422480554665|                    1.0|                    0.0|    0.31769546578365715|  3.552518866000408|                62|                 1| 5.260303491018979|106.13848664083214|           365.0|             0.0|94.38067895328992|-1.5943124550035996|         -364.0|          357.0|118.71833833376009|              887.0|0.5665918825209055|2.307294117647059| 2.395715896279594|3.1319052987598646|-4.6602173453403575|       -365.0|        365.0|116.48534025830608|         1.3925563636961478|       1.2270951384751798|       18.11793596475429|-4.96901396105319|      -365.0|       365.0|117.24836857358947|        1.5386685950158343|     1.1372970237009223|      36.2588797532797|\n+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+-------------------+-------------------+-------------------+-------------------+--------------------+-------------------+--------------------+--------------------+------------------+------------------+-------------------+-------------------+--------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+-------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+-------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+-----------------+-------------------+---------------+---------------+------------------+-------------------+------------------+-----------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-----------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500759189789_1778012772","id":"20170722-143309_433055035","dateCreated":"2017-07-22T14:33:09-0700","dateStarted":"2017-07-24T23:20:22-0700","dateFinished":"2017-07-24T23:32:02-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3024"},{"text":"%spark.pyspark\n#user_product_all.toPandas().to_csv('/data/Instacart/spark/user_product_all.csv',index=False)\nuser_product_all.write.csv('/data/Instacart/spark/user_product_all_spark.csv', header=True)","user":"anonymous","dateUpdated":"2017-07-24T23:34:29-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500771918473_116622022","id":"20170722-180518_1530771911","dateCreated":"2017-07-22T18:05:18-0700","dateStarted":"2017-07-24T23:34:29-0700","dateFinished":"2017-07-24T23:57:48-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3025"},{"text":"%spark.pyspark\nuser_product_all =  spark.read.csv('/data/Instacart/spark/user_product_all_spark.csv', header= True, inferSchema=True)\nuser_product_all.show(5)","user":"anonymous","dateUpdated":"2017-07-25T09:13:05-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------------------+------------------+------------------+------------------+------------------+-------------------+--------+-------+-------+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+-----------------+----------------+----------------+-----------------+-------------------+---------------+---------------+-----------------+-------------------+-------------------+------------------+------------------+-------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|product_id|user_id|up_order_count|up_first_order_number|up_last_order_number|up_average_cart_position|days_sum|days_min|days_max|         days_std|    time_weight_sum|    time_weight_max|    time_weight_min|   time_weight_mean|    time_weight_std|         weight_sum|        weight_mean|         weight_max|         weight_min|          weight_std|  order_weight_sum|  order_weight_min|  order_weight_max| order_weight_mean|   order_weight_std|gap_mean|gap_min|gap_max|gap_std|user_total_order|user_sum_days_since_prior_order|user_mean_days_since_prior_order|user_std_days_since_prior_order|user_max_days_since_prior_order|user_min_days_since_prior_order|user_total_reorder_product|user_distinct_reorder_product|user_total_sec_order_products|user_reorder_ratio2|user_total_products|user_distinct_product|      user_gap_mean|user_gap_min|user_gap_max|      user_gap_std|user_mean_reorder_ratio_per_order|user_min_reorder_ratio_per_order|user_max_reorder_ratio_per_order|user_std_reorder_ratio_per_order|user_average_basket|user_distinct_product_reorder_ratio|order_id|eval_set|time_since_last_order|       up_order_rate|up_order_since_last_order|up_order_rate_since_first_order|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max|  product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min|product_p_time_std|product_days_mean|product_days_max|product_days_min| product_days_std|   product_gap_mean|product_gap_min|product_gap_max|  product_gap_std|unique_reorder_user|      reorder_ratio|      reorder_time|user_reorder_ratio|reorder_time2|     aisle_gap_mean|aisle_gap_min|aisle_gap_max|     aisle_gap_std|aisle_product_reorder_ratio|aisler_user_reorder_ratio|aisler_user_reorder_time|     dept_gap_mean|dept_gap_min|dept_gap_max|      dept_gap_std|dept_product_reorder_ratio|dept_user_reorder_ratio|dept_user_reorder_time|\n+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------------------+------------------+------------------+------------------+------------------+-------------------+--------+-------+-------+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+-----------------+----------------+----------------+-----------------+-------------------+---------------+---------------+-----------------+-------------------+-------------------+------------------+------------------+-------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\n|         2| 106141|             1|                   24|                  24|                     3.0|    26.0|    26.0|    26.0|              NaN| 0.0790273556231003| 0.0790273556231003| 0.0790273556231003| 0.0790273556231003|                NaN| 0.3333333333333333| 0.3333333333333333| 0.3333333333333333| 0.3333333333333333|                 NaN|0.8275862068965517|0.8275862068965517|0.8275862068965517|0.8275862068965517|                NaN|    null|   null|   null|   null|              29|                          329.0|                           11.75|              7.084803768944094|                           30.0|                            2.0|                     123.0|                         54.0|                          262|0.46946564885496184|                265|                  142| 13.463414634146341|      -303.0|       309.0|165.41806414543046|              0.48818095484762153|                             0.1|              0.8888888888888888|               0.217977824221169|  9.137931034482758|                0.38028169014084506| 1409783|   train|                  9.0|0.034482758620689655|                        5|            0.16666666666666666|         90|           12|         78|0.25028884369398646|               1.0|0.022222222222222223|0.30177926576848707|       0.5903660948293091|      0.9836065573770492|     0.02702702702702703|      0.2590940055025205|      0.3993640259541684|                    1.0|                    0.0|     0.3094756546715078| 1.2444444444444445|                 6|                 1| 0.797624437984389|99.82222222222222|           309.0|             0.0|85.10371435638656|-13.416666666666666|         -163.0|          121.0|87.90744961019911|                8.0|0.13333333333333333|1.1538461538461537|              9.75|          1.5|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n|         2|  36347|             1|                   39|                  39|                     1.0|    62.0|    62.0|    62.0|              NaN|0.21830985915492956|0.21830985915492956|0.21830985915492956|0.21830985915492956|                NaN|                1.0|                1.0|                1.0|                1.0|                 NaN|0.6842105263157895|0.6842105263157895|0.6842105263157895|0.6842105263157895|                NaN|    null|   null|   null|   null|              57|                          284.0|               5.071428571428571|              5.523033234002498|                           30.0|                            0.0|                     419.0|                        111.0|                          646| 0.6486068111455109|                663|                  244|  9.329355608591886|      -227.0|       275.0| 85.27462740329253|               0.6546203772331419|                             0.0|                             1.0|             0.19840152379300557| 11.631578947368421|                0.45491803278688525|  869197|   train|                  6.0|0.017543859649122806|                       18|            0.05263157894736842|         90|           12|         78|0.25028884369398646|               1.0|0.022222222222222223|0.30177926576848707|       0.5903660948293091|      0.9836065573770492|     0.02702702702702703|      0.2590940055025205|      0.3993640259541684|                    1.0|                    0.0|     0.3094756546715078| 1.2444444444444445|                 6|                 1| 0.797624437984389|99.82222222222222|           309.0|             0.0|85.10371435638656|-13.416666666666666|         -163.0|          121.0|87.90744961019911|                8.0|0.13333333333333333|1.1538461538461537|              9.75|          1.5|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n|         2|  89428|             1|                   13|                  13|                    16.0|   115.0|   115.0|   115.0|              NaN| 0.8394160583941606| 0.8394160583941606| 0.8394160583941606| 0.8394160583941606|                NaN|             0.0625|             0.0625|             0.0625|             0.0625|                 NaN|0.5909090909090909|0.5909090909090909|0.5909090909090909|0.5909090909090909|                NaN|    null|   null|   null|   null|              22|                          137.0|               6.523809523809524|              2.441701202421124|                           13.0|                            2.0|                     191.0|                         38.0|                          258| 0.7403100775193798|                260|                   69|-1.0628272251308901|      -132.0|       113.0| 68.34684168860205|               0.7479180745724863|             0.07692307692307693|                             1.0|             0.21447013920335084| 11.818181818181818|                 0.5507246376811594| 2268484|   train|                  8.0|0.045454545454545456|                        9|                            0.1|         90|           12|         78|0.25028884369398646|               1.0|0.022222222222222223|0.30177926576848707|       0.5903660948293091|      0.9836065573770492|     0.02702702702702703|      0.2590940055025205|      0.3993640259541684|                    1.0|                    0.0|     0.3094756546715078| 1.2444444444444445|                 6|                 1| 0.797624437984389|99.82222222222222|           309.0|             0.0|85.10371435638656|-13.416666666666666|         -163.0|          121.0|87.90744961019911|                8.0|0.13333333333333333|1.1538461538461537|              9.75|          1.5|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n|         2|  35348|             1|                   12|                  12|                    11.0|    46.0|    46.0|    46.0|              NaN|          0.1796875|          0.1796875|          0.1796875|          0.1796875|                NaN|0.09090909090909091|0.09090909090909091|0.09090909090909091|0.09090909090909091|                 NaN|0.6666666666666666|0.6666666666666666|0.6666666666666666|0.6666666666666666|                NaN|    null|   null|   null|   null|              18|                          256.0|              15.058823529411764|              8.799649057173346|                           30.0|                            0.0|                     176.0|                         52.0|                          237| 0.7426160337552743|                252|                   76|             6.1875|      -256.0|       233.0|115.51224579485685|               0.7736125669136505|             0.17647058823529413|                             1.0|              0.2650749803843451|               14.0|                 0.6842105263157895|  726627|    test|                  8.0| 0.05555555555555555|                        6|            0.14285714285714285|         90|           12|         78|0.25028884369398646|               1.0|0.022222222222222223|0.30177926576848707|       0.5903660948293091|      0.9836065573770492|     0.02702702702702703|      0.2590940055025205|      0.3993640259541684|                    1.0|                    0.0|     0.3094756546715078| 1.2444444444444445|                 6|                 1| 0.797624437984389|99.82222222222222|           309.0|             0.0|85.10371435638656|-13.416666666666666|         -163.0|          121.0|87.90744961019911|                8.0|0.13333333333333333|1.1538461538461537|              9.75|          1.5|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n|         2|  27195|             2|                   10|                  14|                     8.5|   152.0|    24.0|   128.0|73.53910524340094| 0.6972477064220184| 0.5871559633027523|0.11009174311926606| 0.3486238532110092|0.33733534515321534|0.24285714285714285|0.12142857142857143|0.14285714285714285|                0.1|0.030304576336566313| 1.263157894736842|0.5263157894736842|0.7368421052631579| 0.631578947368421|0.14886458551295736|   104.0|  104.0|  104.0|    NaN|              19|                          218.0|               12.11111111111111|               9.46130751372563|                           30.0|                            0.0|                     150.0|                         37.0|                          207| 0.7246376811594203|                216|                   66|-0.6933333333333334|      -218.0|       194.0| 95.16118058761009|               0.6916371597099151|                             0.0|                             1.0|             0.25095923400785997| 11.368421052631579|                 0.5606060606060606|  956208|   train|                 30.0| 0.10526315789473684|                        5|                            0.2|         90|           12|         78|0.25028884369398646|               1.0|0.022222222222222223|0.30177926576848707|       0.5903660948293091|      0.9836065573770492|     0.02702702702702703|      0.2590940055025205|      0.3993640259541684|                    1.0|                    0.0|     0.3094756546715078| 1.2444444444444445|                 6|                 1| 0.797624437984389|99.82222222222222|           309.0|             0.0|85.10371435638656|-13.416666666666666|         -163.0|          121.0|87.90744961019911|                8.0|0.13333333333333333|1.1538461538461537|              9.75|          1.5|-5.5898951146313545|       -364.0|        365.0|120.67575832225177|          6.562049441539556|        5.230864028481446|       2.212857729700123|-6.934916292609115|      -365.0|       365.0|121.31399509458232|        2.8841674855182444|     1.8054742694703398|     6.796340035951674|\n+----------+-------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------------------+------------------+------------------+------------------+------------------+-------------------+--------+-------+-------+-------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+-----------------+----------------+----------------+-----------------+-------------------+---------------+---------------+-----------------+-------------------+-------------------+------------------+------------------+-------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500959657752_-1635796614","id":"20170724-221417_998732947","dateCreated":"2017-07-24T22:14:17-0700","dateStarted":"2017-07-25T09:13:05-0700","dateFinished":"2017-07-25T09:24:28-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3026"},{"text":"%spark.pyspark\ntrain.show(5)","user":"anonymous","dateUpdated":"2017-07-25T09:13:13-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------------+---------+\n|order_id|product_id|add_to_cart_order|reordered|\n+--------+----------+-----------------+---------+\n|       1|     49302|                1|        1|\n|       1|     11109|                2|        1|\n|       1|     10246|                3|        0|\n|       1|     49683|                4|        0|\n|       1|     43633|                5|        1|\n+--------+----------+-----------------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500874505017_-400947989","id":"20170723-223505_554592869","dateCreated":"2017-07-23T22:35:05-0700","dateStarted":"2017-07-25T09:13:13-0700","dateFinished":"2017-07-25T09:24:28-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3027"},{"text":"%spark.pyspark\ntrain = train.join(orders.select('order_id','user_id'), on = 'order_id', how = 'left')\ntrain.show(5)","user":"anonymous","dateUpdated":"2017-07-25T09:33:08-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------------+---------+-------+\n|order_id|product_id|add_to_cart_order|reordered|user_id|\n+--------+----------+-----------------+---------+-------+\n|    1342|     13176|                1|        1| 156818|\n|    1342|     30827|                2|        1| 156818|\n|    1342|     14966|                3|        1| 156818|\n|    1342|     21137|                4|        1| 156818|\n|    1342|     46129|                5|        1| 156818|\n+--------+----------+-----------------+---------+-------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500939101873_-960306496","id":"20170724-163141_738301108","dateCreated":"2017-07-24T16:31:41-0700","dateStarted":"2017-07-25T09:33:08-0700","dateFinished":"2017-07-25T09:33:14-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3028"},{"text":"%spark.pyspark\n\ntrain_spark = user_product_all.filter(user_product_all['eval_set']=='train').join(train.select('user_id','product_id','reordered'), on = ['user_id', 'product_id'], how = 'left')\ntrain_spark.show(5)","user":"anonymous","dateUpdated":"2017-07-25T10:20:17-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+----------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+--------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+------------------+-------------------+---------------+---------------+------------------+-------------------+------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+---------+\n|user_id|product_id|up_order_count|up_first_order_number|up_last_order_number|up_average_cart_position|days_sum|days_min|days_max|         days_std|   time_weight_sum|   time_weight_max|   time_weight_min|  time_weight_mean|    time_weight_std|          weight_sum|         weight_mean|          weight_max|          weight_min|          weight_std|   order_weight_sum|   order_weight_min|   order_weight_max|  order_weight_mean|   order_weight_std|gap_mean|gap_min|gap_max|           gap_std|user_total_order|user_sum_days_since_prior_order|user_mean_days_since_prior_order|user_std_days_since_prior_order|user_max_days_since_prior_order|user_min_days_since_prior_order|user_total_reorder_product|user_distinct_reorder_product|user_total_sec_order_products|user_reorder_ratio2|user_total_products|user_distinct_product|      user_gap_mean|user_gap_min|user_gap_max|      user_gap_std|user_mean_reorder_ratio_per_order|user_min_reorder_ratio_per_order|user_max_reorder_ratio_per_order|user_std_reorder_ratio_per_order|user_average_basket|user_distinct_product_reorder_ratio|order_id|eval_set|time_since_last_order|       up_order_rate|up_order_since_last_order|up_order_rate_since_first_order|order_total|reorder_total|unique_user|product_weight_mean|product_weight_max|  product_weight_min| product_weight_std|product_order_weight_mean|product_order_weight_max|product_order_weight_min|product_order_weight_std|product_time_weight_mean|product_time_weight_max|product_time_weight_min|product_time_weight_std|product_p_time_mean|product_p_time_max|product_p_time_min|product_p_time_std| product_days_mean|product_days_max|product_days_min|  product_days_std|   product_gap_mean|product_gap_min|product_gap_max|   product_gap_std|unique_reorder_user|     reorder_ratio|      reorder_time|user_reorder_ratio|     reorder_time2|     aisle_gap_mean|aisle_gap_min|aisle_gap_max|     aisle_gap_std|aisle_product_reorder_ratio|aisler_user_reorder_ratio|aisler_user_reorder_time|      dept_gap_mean|dept_gap_min|dept_gap_max|      dept_gap_std|dept_product_reorder_ratio|dept_user_reorder_ratio|dept_user_reorder_time|reordered|\n+-------+----------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+--------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+------------------+-------------------+---------------+---------------+------------------+-------------------+------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+---------+\n|      9|     47167|             1|                    1|                   1|                    21.0|     0.0|     0.0|     0.0|              NaN|               0.0|               0.0|               0.0|               0.0|                NaN|0.047619047619047616|0.047619047619047616|0.047619047619047616|0.047619047619047616|                 NaN|               0.25|               0.25|               0.25|               0.25|                NaN|    null|   null|   null|              null|               4|                           66.0|                            22.0|             13.856406460551018|                           30.0|                            6.0|                      18.0|                         17.0|                           46|  0.391304347826087|                 76|                   58|-50.333333333333336|       -66.0|        -6.0|24.535688292770594|              0.38181818181818183|             0.36363636363636365|                             0.4|             0.02571297386132901|               19.0|                0.29310344827586204| 1094988|   train|                 30.0|                0.25|                        3|                           0.25|       2452|         1615|        837|0.18162231204621934|               1.0|0.014084507042253521|0.20598516321200128|       0.5159535059859413|                    0.99|                    0.01|     0.28065628676832927|     0.42546015933622827|                    1.0|                    0.0|    0.32131308115194657|  3.914763458401305|                35|                 1| 4.274886842053797|117.26549755301795|           365.0|             0.0| 97.82514680618245|-4.8086687306501545|         -333.0|          361.0|125.21088995458999|              455.0|0.6586460032626428| 2.929510155316607|1.8395604395604395|3.5494505494505493| -3.863108421780038|       -365.0|        364.0|117.28309132610786|         1.6941722628771905|       1.6557009106066436|      14.476593561626267| -4.006867208164031|      -365.0|       364.0|117.31892011496228|        1.7272027028679255|     1.8042257288044932|     13.12484621556566|     null|\n|     14|      4210|             1|                    7|                   7|                    23.0|   276.0|   276.0|   276.0|              NaN|               1.0|               1.0|               1.0|               1.0|                NaN|0.043478260869565216|0.043478260869565216|0.043478260869565216|0.043478260869565216|                 NaN|                0.5|                0.5|                0.5|                0.5|                NaN|    null|   null|   null|              null|              14|                          276.0|               21.23076923076923|              11.12170435195558|                           30.0|                            2.0|                      68.0|                         30.0|                          205|0.33170731707317075|                210|                  142| 2.6323529411764706|      -276.0|       274.0| 157.6264149781332|               0.3722293742221278|             0.14814814814814814|              0.6666666666666666|             0.17341770261900047|               15.0|                 0.2112676056338028| 2316178|   train|                 11.0| 0.07142857142857142|                        7|                          0.125|      35633|        27749|       7884| 0.4255514741621413|               1.0|0.015873015873015872|0.34304989377664563|       0.5044603426472875|                    0.99|                    0.01|      0.2706095931632637|      0.4114677108061436|                    1.0|                    0.0|     0.3203711954203912|  8.461650717031965|                99|                 1|10.807854424830179|101.45721662503858|           365.0|             0.0| 90.01813340539971| -5.013441925835165|         -365.0|          363.0|110.65005739735703|             4582.0|0.7787444223051666| 4.519660071029934|1.7206460061108686| 6.056089044085552|-5.0597503245895235|       -365.0|        365.0|116.86327213797209|         1.2797085588225157|        1.406301098250267|       8.964503212349843| -5.600647989190623|      -365.0|       365.0|118.21134989306664|        1.4926071502122424|      1.178888696426804|     22.43900945263783|     null|\n|     27|     44786|             1|                    7|                   7|                     7.0|   131.0|   131.0|   131.0|              NaN|0.3649025069637883|0.3649025069637883|0.3649025069637883|0.3649025069637883|                NaN| 0.14285714285714285| 0.14285714285714285| 0.14285714285714285| 0.14285714285714285|                 NaN|0.08536585365853659|0.08536585365853659|0.08536585365853659|0.08536585365853659|                NaN|    null|   null|   null|              null|              82|                          359.0|               4.432098765432099|             3.8985198204092097|                           20.0|                            0.0|                     548.0|                        127.0|                          767| 0.7144719687092569|                768|                  220| -8.332116788321168|      -322.0|       359.0| 130.8821954835605|               0.6776361790673019|                             0.0|                             1.0|             0.29891371197890665|  9.365853658536585|                 0.5772727272727273| 2614670|   train|                  4.0|0.012195121951219513|                       75|           0.013157894736842105|       2272|         1220|       1052|0.23592933790613932|               1.0|  0.0196078431372549|0.23735242883595725|       0.3698271458974355|      0.9836065573770492|                    0.01|     0.26033654390498273|      0.4038422388605227|                    1.0|                    0.0|     0.3331701476561151| 3.2548415492957745|                40|                 1| 4.359325566373836|107.14612676056338|           365.0|             0.0| 94.31543308759642| -9.478688524590163|         -326.0|          332.0|119.10157405893318|              417.0|0.5369718309859155| 2.159695817490494|2.5227817745803356|2.9256594724220624| -4.818768548131501|       -365.0|        365.0|118.30780274594491|         1.6880072223662854|        2.022916968205722|       5.023447676943118| -5.821769112042235|      -365.0|       365.0|118.52122309291707|        1.7416146101293568|     1.4254191109692937|    13.565147312698919|     null|\n|     38|     37119|             3|                    5|                   8|                    13.0|   430.0|    88.0|   171.0|47.92007234273893|1.6475095785440612|0.6551724137931034|0.3371647509578544|0.5491698595146871|0.18360180974229476| 0.24215686274509804| 0.08071895424836602|                 0.1|0.058823529411764705|0.020712355395412847| 1.5384615384615385|0.38461538461538464| 0.6153846153846154| 0.5128205128205129|0.11750194089630359|   -41.5|  -83.0|    0.0| 58.68986283848344|              13|                          261.0|                           21.75|              8.486620485960668|                           30.0|                            7.0|                     107.0|                         38.0|                          181| 0.5911602209944752|                195|                   88| -0.205607476635514|      -261.0|       232.0|134.71239373147273|               0.5990667336853658|             0.14285714285714285|                             0.8|              0.1924595192191793|               15.0|                 0.4318181818181818| 3173750|   train|                 30.0| 0.23076923076923078|                        5|             0.3333333333333333|       8010|         4530|       3480| 0.2233785494102949|               1.0|0.014925373134328358|0.24114318694017894|       0.4987846852581977|                    0.99|                    0.01|     0.28083079871603905|      0.4021700001392107|                    1.0|                    0.0|    0.31998856154857813| 3.7767790262172283|                41|                 1| 4.835654414300423|108.04107365792758|           365.0|             0.0|  94.5369018257588| -7.660485651214128|         -356.0|          362.0|122.44927196822782|             1339.0|0.5655430711610487|2.3017241379310347| 2.598954443614638|3.3831217326362957| -5.782339465810985|       -365.0|        365.0|117.87477122356779|         1.6487588304757295|       1.8076308291055667|      5.5517640790418605|-6.0313243507225325|      -365.0|       365.0|118.71968388192732|         1.645497320243432|     1.5907335448528277|     7.591696077382863|     null|\n|     52|     41400|             3|                   18|                  21|       6.666666666666667|   574.0|   144.0|   239.0|47.50087718488295| 2.401673640167364|               1.0| 0.602510460251046|0.8005578800557881|0.19874844010411272|                0.75|                0.25|                 0.5| 0.08333333333333333| 0.22047927592204922| 2.0714285714285716| 0.6428571428571429|               0.75| 0.6904761904761906|0.05455447255899805|   -24.0|  -95.0|   47.0|100.40916292848975|              28|                          239.0|               8.851851851851851|              5.156800615943242|                           30.0|                            3.0|                     118.0|                         27.0|                          163| 0.7239263803680982|                169|                   51|-15.211864406779661|      -201.0|       136.0| 80.44033215694674|               0.7228050795358489|                             0.2|                             1.0|             0.22786779964109538|  6.035714285714286|                 0.5294117647058824| 1647290|   train|                  3.0| 0.10714285714285714|                        7|             0.2727272727272727|       8723|         5989|       2734|0.41738131350468355|               1.0|0.023809523809523808| 0.3166619094407569|       0.4885622857003249|                    0.99|                    0.01|     0.27433763582565324|     0.45069925842251723|                    1.0|                    0.0|     0.3460985177639025|   5.20061905307807|                46|                 1|6.3324444617697235|118.77014788490199|           365.0|             0.0|100.77748102519115| -7.454833862080481|         -365.0|          365.0|126.11405028565288|             1445.0|0.6865757193626046|3.1905632772494514|1.8920415224913494| 4.144636678200692| -5.233751767904383|       -365.0|        365.0|117.62539867061236|         1.6722213672770976|       1.8108608366318308|       7.771791440043284| -5.821769112042235|      -365.0|       365.0|118.52122309291707|        1.7416146101293568|     1.4254191109692937|    13.565147312698919|     null|\n+-------+----------+--------------+---------------------+--------------------+------------------------+--------+--------+--------+-----------------+------------------+------------------+------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+--------------------+-------------------+-------------------+-------------------+-------------------+-------------------+--------+-------+-------+------------------+----------------+-------------------------------+--------------------------------+-------------------------------+-------------------------------+-------------------------------+--------------------------+-----------------------------+-----------------------------+-------------------+-------------------+---------------------+-------------------+------------+------------+------------------+---------------------------------+--------------------------------+--------------------------------+--------------------------------+-------------------+-----------------------------------+--------+--------+---------------------+--------------------+-------------------------+-------------------------------+-----------+-------------+-----------+-------------------+------------------+--------------------+-------------------+-------------------------+------------------------+------------------------+------------------------+------------------------+-----------------------+-----------------------+-----------------------+-------------------+------------------+------------------+------------------+------------------+----------------+----------------+------------------+-------------------+---------------+---------------+------------------+-------------------+------------------+------------------+------------------+------------------+-------------------+-------------+-------------+------------------+---------------------------+-------------------------+------------------------+-------------------+------------+------------+------------------+--------------------------+-----------------------+----------------------+---------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1500949415859_-1680523399","id":"20170724-192335_1766478368","dateCreated":"2017-07-24T19:23:35-0700","dateStarted":"2017-07-25T10:20:17-0700","dateFinished":"2017-07-25T10:39:02-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3029"},{"text":"%spark.pyspark\n# train_spark.toPandas().to_csv('/data/Instacart/spark/train_spark.csv',index=False)\n# train_spark = user_product_all.filter(user_product_all['eval_set']=='train')\ntrain_spark.write.csv('/data/Instacart/spark/train_spark.csv', header=True)\n","user":"anonymous","dateUpdated":"2017-07-25T10:20:41-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500950407213_948671627","id":"20170724-194007_1919712263","dateCreated":"2017-07-24T19:40:07-0700","dateStarted":"2017-07-25T10:20:41-0700","dateFinished":"2017-07-25T11:10:16-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3030"},{"text":"%spark.pyspark\ntest_spark = user_product_all.filter(user_product_all['eval_set'] =='test')","user":"anonymous","dateUpdated":"2017-07-25T10:07:10-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1501002424041_-544410492","id":"20170725-100704_1379643155","dateCreated":"2017-07-25T10:07:04-0700","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3031"},{"text":"%spark.pyspark\n# test_spark.toPandas().to_csv('/data/Instacart/spark/test_spark.csv',index=False)\ntest_spark.write.csv('/data/Instacart/spark/test_spark.csv', header=True)\n","user":"anonymous","dateUpdated":"2017-07-25T09:35:12-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1500962394546_971348945","id":"20170724-225954_922117747","dateCreated":"2017-07-24T22:59:54-0700","dateStarted":"2017-07-25T09:35:12-0700","dateFinished":"2017-07-25T10:15:44-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3032"},{"text":"%spark.pyspark\n","user":"anonymous","dateUpdated":"2017-07-25T09:13:36-0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1500999216313_-483029625","id":"20170725-091336_1797821427","dateCreated":"2017-07-25T09:13:36-0700","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3033"}],"name":"Instacart/features","id":"2CNVZXAZW","angularObjects":{"2CNZPXFPK:shared_process":[],"2CQHBCVYM:shared_process":[],"2CNG4BP85:shared_process":[],"2CP45Y33E:shared_process":[],"2CQ3ZXC93:shared_process":[],"2CP6MSSYY:shared_process":[],"2CQG2B7MG:shared_process":[],"2CQUGBZ2N:shared_process":[],"2CQM1YCMG:shared_process":[],"2CREJFQZU:shared_process":[],"2CPK7QBY9:shared_process":[],"2CMY55SBH:shared_process":[],"2CPMAVQN1:shared_process":[],"2CMZA3EX5:shared_process":[],"2CQESWUUG:shared_process":[],"2CRGZ621R:shared_process":[],"2CPNSH3AG:shared_process":[],"2CPMF2NH5:shared_process":[],"2CNAT5BV7:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}